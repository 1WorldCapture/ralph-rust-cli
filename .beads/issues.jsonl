{"id":"ralph-cli-6rl","title":"Ralph CLI PRD: Rust 重构为 ralph（once/loop/upgrade）","description":"目标：用 Rust 重构为可分发 CLI（`ralph`），对齐现有 `scripts/ralph-once.sh` 与 `scripts/ralph-loop.sh` 行为；System Prompt 抽离为 `~/.Ralph/` 下可编辑 Markdown；支持版本管理与 `ralph upgrade` 一键升级。\n\n交付：按 US-01..US-05 完成；开放问题在实现前确认。\n","status":"open","priority":2,"issue_type":"epic","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:06:53.572794+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T21:09:12.059764+08:00","labels":["epic","prd","ralph"]}
{"id":"ralph-cli-6rl.1","title":"US-01 发布版本化的 ralph（SemVer + --version）","description":"用户动机：维护者需要发布可追踪、可回滚的稳定产物。\n\n实现：\n- 建立明确版本号机制（建议 SemVer）。\n- `ralph` 提供查看当前版本能力（`ralph --version` 或 `ralph version`）。\n- 发布流程能产出与版本一致的分发产物，并维护变更记录（`CHANGELOG` / release notes）。\n\n验收：\n- 本地构建产物执行 `--version` 输出版本号。\n- 发布产物版本号可辨识且与源码一致。\n","design":"Rust CLI using clap derive for argument parsing. Version is read from Cargo.toml via env!(\"CARGO_PKG_VERSION\") macro, ensuring consistency between source and binary. CHANGELOG.md follows Keep a Changelog format.","notes":"Created: Cargo.toml (v0.1.0), src/main.rs with Cli struct using clap, CHANGELOG.md, scripts/build-release.sh. Both 'ralph --version' and 'ralph version' output version number.","status":"closed","priority":2,"issue_type":"feature","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:07:06.519736+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T21:27:25.994787+08:00","closed_at":"2026-01-14T21:27:25.994787+08:00","close_reason":"Closed","labels":["prd","ralph","release","us-01","versioning"],"dependencies":[{"issue_id":"ralph-cli-6rl.1","depends_on_id":"ralph-cli-6rl","type":"parent-child","created_at":"2026-01-14T21:07:06.523351+08:00","created_by":"Lyon Liang"}]}
{"id":"ralph-cli-6rl.2","title":"US-02 首次运行自动生成 ~/.Ralph/ 与 system-prompt.md","description":"用户动机：安装后无需手动创建配置即可使用，并能随时编辑提示词。\n\n实现：\n- 默认配置目录：`~/.Ralph/`。\n- 默认 Prompt 文件（Markdown）：`system-prompt.md`（文件名可在实现阶段最终确定）。\n- 首次运行：若目录/文件不存在则自动创建，并写入默认 PROMPT（等价脚本内置内容）。\n- 运行时：每次从该文件读取内容作为 System Prompt。\n\n验收：\n- 删除 `~/.Ralph/` 后运行 `ralph`，会自动生成目录与默认 prompt 文件。\n- 修改 prompt 文件后再次运行，传入 provider 的提示词内容随之变化。\n","design":"Uses dirs crate for cross-platform home directory. Config dir: ~/.Ralph/, prompt file: system-prompt.md. Functions: get_config_dir(), get_system_prompt_path(), ensure_config() (creates dir/file if missing), read_system_prompt() (reads content).","notes":"Added dirs v5 dependency. Implemented DEFAULT_SYSTEM_PROMPT const with bd/beads workflow. ensure_config() runs on every startup, creates ~/.Ralph/ and system-prompt.md if missing. Added 4 unit tests for config functions.","status":"closed","priority":2,"issue_type":"feature","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:07:21.403381+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T21:35:14.588677+08:00","closed_at":"2026-01-14T21:35:14.588677+08:00","close_reason":"Closed","labels":["config","prd","prompt","ralph","us-02"],"dependencies":[{"issue_id":"ralph-cli-6rl.2","depends_on_id":"ralph-cli-6rl","type":"parent-child","created_at":"2026-01-14T21:07:21.406754+08:00","created_by":"Lyon Liang"},{"issue_id":"ralph-cli-6rl.2","depends_on_id":"ralph-cli-6rl.1","type":"blocks","created_at":"2026-01-14T21:07:21.40871+08:00","created_by":"Lyon Liang"}]}
{"id":"ralph-cli-6rl.3","title":"US-03 单次执行 once：选择 provider + 注入 prompt","description":"用户动机：像 `ralph-once.sh` 一样，一次性触发 provider 执行并观察输出。\n\n实现：\n- 提供 once 入口（命名可为 `ralph once` 或等价）。\n- 支持 `--provider \u003cname\u003e`（默认 `droid`），并校验合法性。\n- 从 `~/.Ralph/` 读取 System Prompt，并传给 provider 执行一次。\n- 输出 provider 结果到 stdout，并保持退出码语义用于脚本集成。\n\n验收：\n- 使用合法 provider（如 `droid`）能实际调用并产生输出。\n- 非法 provider 返回非 0 且给出明确错误信息。\n- 不带 `--provider` 时默认使用 `droid`。\n","design":"Added Once subcommand to CLI with provider validation, system prompt reading, and provider execution. Uses std::process::Command to spawn provider processes with flags matching ralph-once.sh.","notes":"Added: VALID_PROVIDERS const, Once subcommand, validate_provider(), execute_provider() functions. main() now returns ExitCode. Added 4 new tests for provider validation.","status":"closed","priority":2,"issue_type":"feature","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:07:30.57121+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T22:17:55.280502+08:00","closed_at":"2026-01-14T22:17:55.280502+08:00","close_reason":"Closed","labels":["once","prd","provider","ralph","us-03"],"dependencies":[{"issue_id":"ralph-cli-6rl.3","depends_on_id":"ralph-cli-6rl","type":"parent-child","created_at":"2026-01-14T21:07:30.574782+08:00","created_by":"Lyon Liang"},{"issue_id":"ralph-cli-6rl.3","depends_on_id":"ralph-cli-6rl.2","type":"blocks","created_at":"2026-01-14T21:07:30.576396+08:00","created_by":"Lyon Liang"}]}
{"id":"ralph-cli-6rl.4","title":"US-04 循环执行 loop：迭代次数 + COMPLETE 提前退出 + bd 状态概览","description":"用户动机：像 `ralph-loop.sh` 一样重复调用 provider，直到完成或达到迭代上限。\n\n实现：\n- 提供 loop 入口（命名可为 `ralph loop` 或等价）。\n- 支持 `--provider`（默认 `droid`）与 `--iterations`（默认 `10`，必须为正整数）。\n- 每次迭代执行 provider，并检查输出是否包含 `\u003cpromise\u003eCOMPLETE\u003c/promise\u003e`：包含则提前停止。\n- 循环结束后执行 `bd list --pretty` 输出任务状态概览。\n\n验收：\n- `--iterations 5` 最多执行 5 次 provider 调用。\n- 命中 COMPLETE 标记后提前结束并输出完成提示与 `bd list --pretty` 结果。\n- `--iterations 0` 或非数字报错并以非 0 退出。\n","status":"open","priority":2,"issue_type":"feature","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:07:42.022618+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T21:09:32.450105+08:00","labels":["loop","prd","ralph","us-04"],"dependencies":[{"issue_id":"ralph-cli-6rl.4","depends_on_id":"ralph-cli-6rl","type":"parent-child","created_at":"2026-01-14T21:07:42.023353+08:00","created_by":"Lyon Liang"},{"issue_id":"ralph-cli-6rl.4","depends_on_id":"ralph-cli-6rl.3","type":"blocks","created_at":"2026-01-14T21:07:42.024888+08:00","created_by":"Lyon Liang"}]}
{"id":"ralph-cli-6rl.5","title":"实现前确认：分发/升级渠道与 CLI 形态（TDD）","description":"开放问题需要在实现前确认：\n- 分发与升级渠道：GitHub Releases vs 包管理器（Homebrew/Cargo）等；upgrade 的下载/替换策略与校验（checksum/签名）。\n- `~/.Ralph/` 是否预留 provider 配置（命令模板/flags）以便未来扩展。\n- CLI 最终结构：`ralph once/loop` vs `ralph run/loop`；是否提供 `ralph-once`/`ralph-loop` 别名。\n\n产出：技术设计文档（TDD）+ 决策记录，供 US-01/US-05 落地。\n","status":"open","priority":2,"issue_type":"task","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:07:54.904257+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T21:09:37.524181+08:00","labels":["design","open-questions","prd","ralph"],"dependencies":[{"issue_id":"ralph-cli-6rl.5","depends_on_id":"ralph-cli-6rl","type":"parent-child","created_at":"2026-01-14T21:07:54.904854+08:00","created_by":"Lyon Liang"}]}
{"id":"ralph-cli-6rl.6","title":"US-05 ralph upgrade：一键升级到最新版本","description":"用户动机：有新版本发布时无需手动下载替换二进制，只需一条命令完成升级。\n\n实现：\n- 提供 `ralph upgrade` 命令，自动检测最新版本并完成升级安装。\n- 升级过程展示当前版本与目标版本，并输出明确进度/结果。\n- 若权限不足无法写入目标路径，输出可操作的解决方案提示。\n\n验收：\n- 有新版本时执行 `ralph upgrade` 后，`ralph --version` 从旧变新。\n- 无更新时提示已是最新版本且退出码为 0。\n- 写入失败时命令失败并给出明确原因与下一步建议。\n","status":"open","priority":2,"issue_type":"feature","owner":"lyon.liang12@gmail.com","created_at":"2026-01-14T21:08:08.469528+08:00","created_by":"Lyon Liang","updated_at":"2026-01-14T21:09:42.610013+08:00","labels":["prd","ralph","upgrade","us-05"],"dependencies":[{"issue_id":"ralph-cli-6rl.6","depends_on_id":"ralph-cli-6rl","type":"parent-child","created_at":"2026-01-14T21:08:08.470051+08:00","created_by":"Lyon Liang"},{"issue_id":"ralph-cli-6rl.6","depends_on_id":"ralph-cli-6rl.1","type":"blocks","created_at":"2026-01-14T21:08:08.471049+08:00","created_by":"Lyon Liang"},{"issue_id":"ralph-cli-6rl.6","depends_on_id":"ralph-cli-6rl.5","type":"blocks","created_at":"2026-01-14T21:08:08.471537+08:00","created_by":"Lyon Liang"}]}
